var BSON=require("mongodb").BSON,ObjectID=require("mongodb").ObjectID,JobService=require("./JobService").JobService;JobCardService=function(e){this.db=e,this.jobService=new JobService(e)},JobCardService.prototype.getCollection=function(e){this.db.collection("jobcard",function(o,n){o?e(o):e(null,n)})},JobCardService.prototype.findAll=function(e){this.getCollection(function(o,n){o?e(o):n.find().sort({created_at:-1}).toArray(function(o,n){o?e(o):e(null,n)})})},JobCardService.prototype.save=function(e,o){this.getCollection(function(n,t){if(n)o(n);else{"undefined"==typeof e.length&&(e=[e]);for(var i=0;i<e.length;i++)jobcard=e[i],jobcard.created_at=new Date;t.insert(e,function(){o(null,e)})}})},JobCardService.prototype.findOne=function(e,o){this.getCollection(function(n,t){n?o(n):t.findOne({id:e},function(e,n){e?o(e):o(null,n)})})},JobCardService.prototype.update=function(e,o){this.getCollection(function(n,t){n?o(n):t.update({id:e.id},{$set:{jobnumber:e.jobnumber,clientrequest:e.clientrequest,task:e.task,note:e.note}},function(e,n){o(e?e:n)})})},JobCardService.prototype.remove=function(e,o){this.getCollection(function(n,t){n?o(n):t.remove({id:e},{justOne:!0},function(e,n){o(n)})})},JobCardService.prototype.search=function(e,o){this.getCollection(function(n,t){n?o(n):t.find({jobnumber:e},function(e,n){e?o(e):o(null,n)})})},JobCardService.prototype.findJobcardAndJob=function(e,o){this.getCollection(function(n,t){t.findOne({id:e},function(e,n){this.jobService.findByJobNumber(n.jobnumber,function(e,t){t.toArray(function(e,t){o(null,n,t[0])})})})})},exports.JobCardService=JobCardService;
